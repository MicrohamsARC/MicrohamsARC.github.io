---
/**
 * Events Listing Page
 * 
 * Displays upcoming and past events with filtering
 */

import BaseLayout from '../../layouts/BaseLayout.astro';
import EventCard from '../../components/event/EventCard.astro';
import { getCollection } from 'astro:content';
import { publishedFilter } from '../../utils/content';

// Get all events, sorted by date (newest first)
const allEvents = await getCollection('events', publishedFilter);
const sortedEvents = allEvents.sort((a, b) => 
  b.data.eventDate.getTime() - a.data.eventDate.getTime()
);

// Split into upcoming and past events
const now = new Date();
const upcomingEvents = sortedEvents.filter(event => event.data.eventDate >= now);
const pastEvents = sortedEvents.filter(event => event.data.eventDate < now);
---

<BaseLayout 
  title="Events" 
  description="Upcoming and past events for the MicroHAMS amateur radio community"
>
  <!-- Page Header -->
  <section class="region">
    <div class="wrapper wrapper--full">
      <div class="stack-4">
        <h1 class="text-4xl">Events</h1>
        <p class="lead" style="max-inline-size: var(--measure-wide);">
          Join us for meetings, conferences, field days, and other amateur radio activities. 
          All members and guests are welcome!
        </p>
      </div>
    </div>
  </section>

  <!-- Upcoming Events -->
  {upcomingEvents.length > 0 && (
    <section class="region" style="background-color: var(--color-surface-muted);">
      <div class="wrapper wrapper--full">
        <div class="stack-8">
          <h2>Upcoming Events</h2>
          <div class="stack-6">
            {upcomingEvents.map((event) => (
              <EventCard event={event} variant="horizontal" showJoinButtons />
            ))}
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Past Events -->
  {pastEvents.length > 0 && (
    <section class="region">
      <div class="wrapper wrapper--full">
        <div class="stack-8">
          <h2>Past Events</h2>
          <div class="grid grid--auto-fit">
            {pastEvents.map((event) => (
              <EventCard event={event} variant="default" />
            ))}
          </div>
        </div>
      </div>
    </section>
  )}

</BaseLayout>
