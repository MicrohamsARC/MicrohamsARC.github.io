---
/**
 * Base Layout - Main Site Structure
 * 
 * Separation of concerns: structure, not style
 * All styling comes from design system
 */

// Import main stylesheet - Astro will process and bundle it
import '../styles/main.css';

interface Props {
  title: string;
  description?: string;
  author?: string;
}

const { title, description = 'MicroHAMS - Amateur Radio Community', author } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    {author && <meta name="author" content={author} />}
    <meta name="generator" content={Astro.generator} />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- Google Fonts - Noto Serif JP (Primary) + Geist Sans/Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;300;400;500;600;700;900&family=Geist:wght@100..900&family=Geist+Mono:wght@100..900&display=swap" rel="stylesheet" />
    
    <title>{title} | MicroHAMS</title>
    
    <!-- Theme initialization (blocking to prevent flash) -->
    <script is:inline>
      // Vignelli: "Systematic, not spontaneous"
      (function() {
        const stored = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = stored || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>
  
  <body>
    <!-- Site Header -->
    <header class="site-header">
      <div class="wrapper">
        <div class="site-header__inner">
          <div class="site-header__brand">
            <a href="/" class="site-header__logo">
              MicroHAMS
            </a>
            <p class="site-header__tagline">
              A community-driven resource for amateur radio enthusiasts
            </p>
          </div>
          
          <nav class="nav" id="active-nav">
            <ul class="nav__list">
              <li><a href="/events" class="nav__link" data-path="/events">Events</a></li>
              <li><a href="/articles" class="nav__link" data-path="/articles">Articles</a></li>
              <li><a href="/docs" class="nav__link" data-path="/docs">Docs</a></li>
              <li><a href="/about" class="nav__link" data-path="/about">About</a></li>
              <li>
                <button 
                  id="theme-toggle" 
                  class="theme-toggle"
                  aria-label="Toggle dark mode"
                  type="button"
                >
                  <span class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true">☀</span>
                  <span class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true">☾</span>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main>
      <slot />
    </main>

    <!-- Site Footer -->
    <footer class="site-footer">
      <div class="wrapper">
        <div class="site-footer__inner">
          <div class="stack-2">
            <p class="font-semibold">MicroHAMS</p>
            <p class="text-sm">Amateur Radio Community</p>
          </div>
          
          <div class="stack-2">
            <p class="text-sm font-semibold">Navigation</p>
            <nav>
              <ul class="stack-2" role="list">
                <li><a href="/" class="text-sm">Home</a></li>
                <li><a href="/events" class="text-sm">Events</a></li>
                <li><a href="/articles" class="text-sm">Articles</a></li>
                <li><a href="/docs" class="text-sm">Docs</a></li>
              </ul>
            </nav>
          </div>
          
          <div class="stack-2">
            <p class="text-sm font-semibold">Connect</p>
            <ul class="stack-2" role="list">
              <li><a href="https://github.com/microhams" class="text-sm">GitHub</a></li>
              <li><a href="/contact" class="text-sm">Contact</a></li>
            </ul>
          </div>
        </div>
        
        <div class="text-center" style="margin-block-start: var(--space-8);">
          <p class="text-xs">
            © {new Date().getFullYear()} MicroHAMS. Built with <a href="https://astro.build">Astro</a>.
          </p>
        </div>
      </div>
    </footer>
    
    <!-- Island Scripts - Load after page interactive -->
    <script>
      // Theme Toggle
      function toggleTheme() {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      }

      const themeButton = document.getElementById('theme-toggle');
      if (themeButton) {
        themeButton.addEventListener('click', toggleTheme);
      }

      // Active Nav
      function setActiveNav() {
        const currentPath = window.location.pathname;
        const links = document.querySelectorAll('#active-nav .nav__link');
        
        links.forEach(link => {
          const linkPath = link.getAttribute('data-path');
          if (linkPath && (currentPath === linkPath || currentPath.startsWith(linkPath + '/'))) {
            link.setAttribute('data-active', 'true');
          } else {
            link.removeAttribute('data-active');
          }
        });
      }

      setActiveNav();
    </script>
  </body>
</html>
